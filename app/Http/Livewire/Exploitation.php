<?php

namespace App\Http\Livewire;

use App\Models\Exploitation1;
use App\Models\Exploitation2;
use App\Models\Formulaire;
use App\Models\Titreminier;
use Livewire\Component;

class Exploitation extends Component
{
    //Exploitation 1 F
    public $sondage, $grille, $metrage, $intervalle, $intersection, $teneur, $unite;
    //Exploitation 2
    public $nombreEchantillon,$nomLabo,$pays_id,$typeanalyse_id;
    public $IDFormulaire;
    public $exploi1;
    public $exploi2;
    protected $listeners = [
        'getFormulaireId'
    ];



    public function getFormulaireId($id)
    {
        $this->IDFormulaire = $id;

    }

    public function resetField()
    {
        $this->sondage = '';
        $this->grille  = '';
        $this->metrage  = '';
        $this->intervalle  = '';
        $this->intersection  = '';
        $this->teneur  = '';
        $this->unite  = '';
        $this->IDFormulaire  = '';
    }

    public function saveExploitation()
    {
        $exploitation1 = new Exploitation1;
        $exploitation1->typesondage_id = $this->sondage;
        $exploitation1->grille = $this->grille;
        $exploitation1->metrage = $this->metrage;
        $exploitation1->intervalle = $this->intervalle;
        $exploitation1->intersection = $this->intersection;
        $exploitation1->teneur = $this->teneur;
        $exploitation1->unite = $this->unite;
        $exploitation1->formulaire_id = $this->IDFormulaire;
        $exploitation1->save();
        session()->flash('success-exploitation1', 'Formulaire B1.2 ajouté');

    }

    public function saveExploitation2()
    {
        $exploitation2 = new Exploitation2();
        $exploitation2->formulaire_id = $this->IDFormulaire;
        $exploitation2->typeanalyse_id= $this->typeanalyse_id;
        $exploitation2->nombreEchantillon = $this->nombreEchantillon;
        $exploitation2->nomLabo = $this->nomLabo;
        $exploitation2->pays_id = $this->pays_id;
        $exploitation2->save();
        session()->flash('success-exploitation2','Formulaire B1.2 ajouté');
    }

    public function exploitation3()
    {

    }

    public function render()
    {
        $this->exploi1 = Exploitation1::where('formulaire_id', $this->IDFormulaire)
            ->get();

        $this->exploi2 = Exploitation2::where('formulaire_id', $this->IDFormulaire)
            ->get();
        return view('livewire.formulaires.exploitation');
    }
}
